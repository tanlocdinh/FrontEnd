{"ast":null,"code":"var _jsxFileName = \"/Users/locdinh/Desktop/2808-Assignment-Source/mern-social-media/client/src/SocketClient.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { POST_TYPES } from \"./redux/actions/postAction\";\nimport { ADMIN_TYPES } from \"./redux/actions/adminAction\";\nimport { GLOBALTYPES } from \"./redux/actions/globalTypes\";\nimport { NOTIFY_TYPES } from \"./redux/actions/notifyAction\";\nimport { MESSAGE_TYPES } from \"./redux/actions/messageAction\";\nimport audioTone from './audio/pristine-609.mp3';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst spawnNotification = (body, icon, url, title) => {\n  let options = {\n    body,\n    icon\n  };\n  let n = new Notification(title, options);\n\n  n.onclick = e => {\n    e.preventDefault();\n    window.open(url, '_blank');\n  };\n};\n\nconst SocketClient = () => {\n  _s();\n\n  const {\n    auth,\n    socket,\n    notify\n  } = useSelector(state => state);\n  const dispatch = useDispatch();\n  const audioRef = useRef(); //!connection\n\n  useEffect(() => {\n    if (auth.user.role === \"user\") {\n      socket.emit(\"joinUser\", auth.user._id);\n    } else if (auth.user.role === \"admin\") {\n      socket.emit(\"joinAdmin\", auth.user._id);\n    }\n  }, [socket, auth.user.role, auth.user._id]);\n  useEffect(() => {\n    socket.on(\"getActiveUsersToClient\", totalActiveUsers => {\n      dispatch({\n        type: ADMIN_TYPES.GET_TOTAL_ACTIVE_USERS,\n        payload: totalActiveUsers\n      });\n    });\n    return () => socket.off(\"getActiveUsersToClient\");\n  }, [socket, dispatch]); //!like Post\n\n  useEffect(() => {\n    socket.on(\"likeToClient\", newPost => {\n      dispatch({\n        type: POST_TYPES.UPDATE_POST,\n        payload: newPost\n      });\n    });\n    return () => socket.off(\"likeToClient\");\n  }, [socket, dispatch]); //!Unlike Post\n\n  useEffect(() => {\n    socket.on(\"unLikeToClient\", newPost => {\n      dispatch({\n        type: POST_TYPES.UPDATE_POST,\n        payload: newPost\n      });\n    });\n    return () => socket.off(\"unLikeToClient\");\n  }, [socket, dispatch]); //!Comments\n\n  useEffect(() => {\n    socket.on(\"createCommentToClient\", newPost => {\n      dispatch({\n        type: POST_TYPES.UPDATE_POST,\n        payload: newPost\n      });\n    });\n    return () => socket.off(\"createCommentToClient\");\n  }, [socket, dispatch]);\n  useEffect(() => {\n    socket.on(\"deleteCommentToClient\", newPost => {\n      dispatch({\n        type: POST_TYPES.UPDATE_POST,\n        payload: newPost\n      });\n    });\n    return () => socket.off(\"deleteCommentToClient\");\n  }, [socket, dispatch]); //!Follow\n\n  useEffect(() => {\n    socket.on(\"followToClient\", newUser => {\n      dispatch({\n        type: GLOBALTYPES.AUTH,\n        payload: { ...auth,\n          user: newUser\n        }\n      });\n    });\n    return () => socket.off(\"followToClient\");\n  }, [socket, dispatch, auth]);\n  useEffect(() => {\n    socket.on(\"unFollowToClient\", newUser => {\n      dispatch({\n        type: GLOBALTYPES.AUTH,\n        payload: { ...auth,\n          user: newUser\n        }\n      });\n    });\n    return () => socket.off(\"unFollowToClient\");\n  }, [socket, dispatch, auth]); //!Notifications\n\n  useEffect(() => {\n    socket.on(\"createNotifyToClient\", msg => {\n      dispatch({\n        type: NOTIFY_TYPES.CREATE_NOTIFY,\n        payload: msg\n      });\n\n      if (notify.sound) {\n        audioRef.current.play();\n      }\n\n      spawnNotification(msg.user.username + \" \" + msg.text, msg.user.avatar, msg.url, \"CAMPUS CONNECT\");\n    });\n    return () => socket.off(\"createNotifyToClient\");\n  }, [socket, dispatch, notify.sound]);\n  useEffect(() => {\n    socket.on(\"removeNotifyToClient\", msg => {\n      dispatch({\n        type: NOTIFY_TYPES.REMOVE_NOTIFY,\n        payload: msg\n      });\n    });\n    return () => socket.off(\"removeNotifyToClient\");\n  }, [socket, dispatch]); //!Messages\n\n  useEffect(() => {\n    socket.on(\"addMessageToClient\", msg => {\n      dispatch({\n        type: MESSAGE_TYPES.ADD_MESSAGE,\n        payload: msg\n      });\n    });\n    return () => socket.off(\"addMessageToClient\");\n  }, []);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"audio\", {\n      controls: true,\n      ref: audioRef,\n      style: {\n        display: \"none\"\n      },\n      children: /*#__PURE__*/_jsxDEV(\"source\", {\n        src: audioTone,\n        type: \"audio/mp3\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n};\n\n_s(SocketClient, \"73xmQjRVcTE9KoqDu+sbC6f1AVU=\", false, function () {\n  return [useSelector, useDispatch];\n});\n\n_c = SocketClient;\nexport default SocketClient;\n\nvar _c;\n\n$RefreshReg$(_c, \"SocketClient\");","map":{"version":3,"sources":["/Users/locdinh/Desktop/2808-Assignment-Source/mern-social-media/client/src/SocketClient.js"],"names":["React","useEffect","useRef","useDispatch","useSelector","POST_TYPES","ADMIN_TYPES","GLOBALTYPES","NOTIFY_TYPES","MESSAGE_TYPES","audioTone","spawnNotification","body","icon","url","title","options","n","Notification","onclick","e","preventDefault","window","open","SocketClient","auth","socket","notify","state","dispatch","audioRef","user","role","emit","_id","on","totalActiveUsers","type","GET_TOTAL_ACTIVE_USERS","payload","off","newPost","UPDATE_POST","newUser","AUTH","msg","CREATE_NOTIFY","sound","current","play","username","text","avatar","REMOVE_NOTIFY","ADD_MESSAGE","display"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { POST_TYPES } from \"./redux/actions/postAction\";\r\nimport { ADMIN_TYPES } from \"./redux/actions/adminAction\";\r\nimport { GLOBALTYPES } from \"./redux/actions/globalTypes\";\r\nimport { NOTIFY_TYPES } from \"./redux/actions/notifyAction\";\r\nimport { MESSAGE_TYPES } from \"./redux/actions/messageAction\";\r\n\r\nimport audioTone from './audio/pristine-609.mp3' \r\n\r\nconst spawnNotification = (body, icon, url, title) => {\r\n  let options = {\r\n    body, icon\r\n  }\r\n  let n = new Notification(title, options);\r\n  n.onclick =  e => {\r\n    e.preventDefault();\r\n    window.open(url, '_blank');\r\n  }\r\n}\r\n\r\nconst SocketClient = () => {\r\n  const { auth, socket, notify } = useSelector((state) => state);\r\n  const dispatch = useDispatch();\r\n\r\n  const audioRef = useRef();\r\n\r\n  //!connection\r\n  useEffect(() => {\r\n    if (auth.user.role === \"user\") {\r\n      socket.emit(\"joinUser\", auth.user._id);\r\n    } else if (auth.user.role === \"admin\") {\r\n      socket.emit(\"joinAdmin\", auth.user._id);\r\n    }\r\n  }, [socket, auth.user.role, auth.user._id]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"getActiveUsersToClient\", (totalActiveUsers) => {\r\n      dispatch({\r\n        type: ADMIN_TYPES.GET_TOTAL_ACTIVE_USERS,\r\n        payload: totalActiveUsers,\r\n      });\r\n    });\r\n    return () => socket.off(\"getActiveUsersToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!like Post\r\n  useEffect(() => {\r\n    socket.on(\"likeToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"likeToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Unlike Post\r\n  useEffect(() => {\r\n    socket.on(\"unLikeToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"unLikeToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Comments\r\n  useEffect(() => {\r\n    socket.on(\"createCommentToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"createCommentToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"deleteCommentToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"deleteCommentToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Follow\r\n  useEffect(() => {\r\n    socket.on(\"followToClient\", (newUser) => {\r\n      dispatch({ type: GLOBALTYPES.AUTH, payload: { ...auth, user: newUser } });\r\n    });\r\n    return () => socket.off(\"followToClient\");\r\n  }, [socket, dispatch, auth]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"unFollowToClient\", (newUser) => {\r\n      dispatch({\r\n        type: GLOBALTYPES.AUTH,\r\n        payload: { ...auth, user: newUser },\r\n      });\r\n    });\r\n    return () => socket.off(\"unFollowToClient\");\r\n  }, [socket, dispatch, auth]);\r\n\r\n  //!Notifications\r\n  useEffect(() => {\r\n    socket.on(\"createNotifyToClient\", (msg) => {\r\n      dispatch({ type: NOTIFY_TYPES.CREATE_NOTIFY, payload: msg });\r\n\r\n      if (notify.sound) {\r\n        audioRef.current.play();\r\n      }\r\n      spawnNotification(\r\n        msg.user.username + \" \" + msg.text,\r\n        msg.user.avatar,\r\n        msg.url,\r\n        \"CAMPUS CONNECT\"\r\n      );\r\n    });\r\n    return () => socket.off(\"createNotifyToClient\");\r\n  }, [socket, dispatch, notify.sound]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"removeNotifyToClient\", (msg) => {\r\n      dispatch({ type: NOTIFY_TYPES.REMOVE_NOTIFY, payload: msg });\r\n    });\r\n    return () => socket.off(\"removeNotifyToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Messages\r\n  useEffect(() => {\r\n    socket.on(\"addMessageToClient\", (msg) => {\r\n      dispatch({ type: MESSAGE_TYPES.ADD_MESSAGE, payload: msg });\r\n\r\n    });\r\n    return () => socket.off(\"addMessageToClient\");\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <audio controls ref={audioRef} style={{ display: \"none\" }}>\r\n        <source src={audioTone} type=\"audio/mp3\" />\r\n      </audio>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SocketClient;\r\n"]},"metadata":{},"sourceType":"module"}